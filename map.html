<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>LOCATE</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
    <style type="text/css">  
        html{height:100%}  
        body{height:100%;margin:0px;padding:0px}  
        #container{height:100%}
        .search{position: absolute; top: 30px; left: 30px;}
    </style>  
    <script src="http://api.map.baidu.com/api?v=2.0&ak=zkjEAN01X00kFf3u6tgn9Xdl">
    </script>
</head>

<body>
    <div id="container"></div>
    <div class="search"><input type="text" name="search"><button onclick="search();">search</button><button onclick="removePt();">delete</button></div>
    <script>
        var map = new BMap.Map("container");
        var point = new BMap.Point(116.404, 39.915); 
        map.centerAndZoom(point, 12);
        map.enableScrollWheelZoom(true);

        //定位你的位置
        function myFun(result){
        var cityName = result.name;
        map.setCenter(cityName);
        alert("当前定位城市:"+cityName);
        }
        var myCity = new BMap.LocalCity();
        myCity.get(myFun);

        //给地图添加点击事件，弹出距离输入对话框
        map.addEventListener("click", function(e) {   
            var ds = window.prompt("Input Distance:(M)", "");

            var pt = e.point;
            var marker = new BMap.Marker(pt);
            map.addOverlay(marker);
            marker.enableDragging();

            //给图标添加右键监听，删除该位置及范围
            marker.addEventListener("rightclick", function(e) {
                map.removeOverlay(marker);
                map.removeOverlay(circle);
            });

            //地图范围圆形覆盖物
            var circle = new BMap.Circle(pt, ds);
            circle.setStrokeWeight(2);
            circle.setFillOpacity(0.35);
            map.addOverlay(circle);

            //给图标添加拖拽监听
            marker.addEventListener("dragging", function(e) {
                circle.setCenter(e.point);
            });
        });

        //搜索位置
        /**/
        function search() {
            var inputKey = document.querySelector("input").value;
            var local = new BMap.LocalSearch(map, {
                renderOptions:{map: map}
            });
            local.search(inputKey);
        }


        var allOverlay = map.getOverlays();
        function removePt() {
            map.removeOverlay(allOverlay);
        }
        
    </script> 
</body>
</html>